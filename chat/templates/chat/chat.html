{% extends 'chat/base.html' %}

{% block title %}Babbler{%endblock title %}

{% block content %}

<div id="id_chat">
    <ul id="messages"></ul>
</div>

<div class="form">
    <form>
        <input id="id_message" autocomplete="off"/><button id="id_send">Send</button>
    </form>
</div>

{% endblock content %}

{% block script%}
<script>
    var socket = new WebSocket('ws://' + window.location.host + '/chat/');
    console.log(socket)
    socket.onopen = function open() {
      console.log("connected");
    };

    socket.onmessage = function(e) {
        var message=$("<li></li>");
        message.html(e.data);
        $('#messages').append(message);
    }

    if (socket.readyState == WebSocket.OPEN) {
      socket.onopen();
    }

    $("form").submit(function(){
        var m=$("#id_message").val();
        socket.send(m);
        $("#id_message").val("");
        return false;
    })
  </script>
{% endblock script%}